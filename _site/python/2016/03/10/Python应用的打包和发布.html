<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>如何打包和发布 python 应用---(上)</title>
  <meta name="description" content="                                                 ">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://wsfdl.com/python/2016/03/10/Python%E5%BA%94%E7%94%A8%E7%9A%84%E6%89%93%E5%8C%85%E5%92%8C%E5%8F%91%E5%B8%83.html">
  <link rel="alternate" type="application/rss+xml" title="koala bear" href="http://wsfdl.com/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/">koala bear</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About Me</a>
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">如何打包和发布 python 应用---(上)</h1>
    <p class="post-meta"><time datetime="2016-03-10T00:00:00+08:00" itemprop="datePublished">Mar 10, 2016</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>                                                 <img src="http://7xp2eu.com1.z0.glb.clouddn.com/pipylog.png" alt="pypilog" /></p>

<p><a href="http://python-packaging-user-guide.readthedocs.org/en/latest/distributing/">Packaging and Distributing Projects</a> 介绍了 python application 的打包和发布规范，只有满足这种规范的 package 才能被 pip 等包管理工具管理。<a href="http://pythonhosted.org/setuptools/index.html">setuptools</a> 是常用的打包工具，其文档 <a href="http://pythonhosted.org/setuptools/setuptools.html">Building and Distributing Packages with Setuptools</a> 同样详细的阐述打包规范。本文以名为 koala 的 application 为例(官网例子请见 <a href="https://github.com/pypa/sampleproject">PyPA sample project</a>)，展示如何编写一个标准的 package，期间主要涉及三个步骤：</p>

<ul>
  <li>Configure: python application 的文件和目录组织</li>
  <li>Package: 打包 application</li>
  <li>Distribute: 把打包后的 application 发布到 Pypi 中</li>
</ul>

<hr />

<h1 id="id-configuring-your-project">Configuring your Project</h1>

<p>编写 application 时，需要注意两方面的规范：</p>

<ul>
  <li>文件目录组织：包含目录组织规范、某些必需的文件</li>
  <li>setup.py：打包的参数信息</li>
</ul>

<h2 id="id-initial-files">Initial Files</h2>

<p>我们以 koala 为例，这是一个非常简单的 application，其目录结构及文件名称如下所示：</p>

<pre><code>koala
├── setup.py
├── setup.cfg
├── README.rst
├── MANIFEST.in
└── koala
    ├── __init__.py
    └── main.py
</code></pre>

<p>从上图可知，koala 的根目录必须包含四个基本文件：</p>

<ul>
  <li>setup.py: 最为重要的文件，包含了打包的参数和基本信息，下节请见详细介绍</li>
  <li>setup.cfg: setup.py 的配置文件，其格式为 <a href="https://en.wikipedia.org/wiki/INI_file">INI</a></li>
  <li>README.rst: 一个 <a href="http://docutils.sourceforge.net/rst.html">reStructuredText</a> 格式的文件，用于介绍项目</li>
  <li>MANIFEST.in: 记录某些需要被打包但未被 setup.py 包含的文件，其格式和规范请见 <a href="https://docs.python.org/2/distutils/sourcedist.html#the-manifest-in-template">The MANIFEST.in template</a></li>
</ul>

<p>setup.py 文件内容请见下节。</p>

<p>setup.cfg 和 MANIFEST.in 在本例中均为空文件。</p>

<p>README.rst 文件的内容如下：</p>

<pre><code class="language-rst">$ cat README.rst
=====
Koala
=====

This project provides a demo for packaging and distributing python application.
</code></pre>

<p>koala/__init__.py 为空文件，koala/main.py 文件的内容如下：</p>

<pre><code>$ cat koala/main.py
print("A demo for python package.")
</code></pre>

<h2 id="id-setuppy">Setup.py</h2>

<p>setup.py 有两个非常重要的函数：</p>

<ul>
  <li>setup(): 该函数囊括了打包的参数和信息</li>
  <li>打包命令的入口: python setup.py –help 可以查看可用的命令</li>
</ul>

<p>本例 setup.py 文件的内容如下:</p>

<pre><code class="language-python">import os

import setuptools


setuptools.setup(
    name='koala',
    version='2016.03.1',
    description='A demo for python packaging.',
    long_description=open(
        os.path.join(
            os.path.dirname(__file__),
            'README.rst'
        )
    ).read(),
    author='vanderliang',
    author_email='vanderliang@gmail.com',
    url='https://github.com/DeliangFan/koala',
    packages=setuptools.find_packages(),
    classifiers=[
        "Development Status :: 4 - Beta",
        "Environment :: OpenStack",
        "Intended Audience :: Information Technology",
        "Intended Audience :: System Administrators",
        "License :: OSI Approved :: Apache Software License",
        "Operating System :: POSIX :: Linux",
        "Programming Language :: Python",
        "Programming Language :: Python :: 2",
        "Programming Language :: Python :: 2.6",
        "Programming Language :: Python :: 2.7"
    ]
)
</code></pre>

<ul>
  <li>name: 即项目名称，本例为 koala</li>
  <li>version: 即版本号，关于版本号的取法请见 <a href="https://packaging.python.org/en/latest/distributing/#choosing-a-versioning-scheme">Choosing a versioning scheme</a></li>
  <li>description: 项目简介</li>
  <li>long_description: 项目详细介绍</li>
  <li>author: 作者名称</li>
  <li>author_email: 作者邮箱</li>
  <li>url: 项目的 homepage</li>
  <li>packages: 项目包括的 python package，setuptools.find_packages() 可自动找出包含的 package</li>
  <li>classifiers:</li>
</ul>

<pre><code class="language-python">classifiers=[
    # How mature is this project? Common values are
    #   3 - Alpha
    #   4 - Beta
    #   5 - Production/Stable
    'Development Status :: 3 - Alpha',

    # Indicate who your project is intended for
    'Intended Audience :: Developers',
    'Topic :: Software Development :: Build Tools',

    # Pick your license as you wish (should match "license" above)
     'License :: OSI Approved :: MIT License',

    # Specify the Python versions you support here. In particular, ensure
    # that you indicate whether you support Python 2, Python 3 or both.
    'Programming Language :: Python :: 2',
    'Programming Language :: Python :: 2.6',
    'Programming Language :: Python :: 2.7',
    'Programming Language :: Python :: 3',
    'Programming Language :: Python :: 3.2',
    'Programming Language :: Python :: 3.3',
    'Programming Language :: Python :: 3.4',
],
</code></pre>

<ul>
  <li>license: Provide the type of license you are using.</li>
  <li>keywords: List keywords that describe your project.</li>
  <li>install_requires: “install_requires” should be used to specify what dependencies a project minimally needs to run.</li>
  <li>
    <p>package_data: Often, additional files need to be installed into a package. These files are often data that’s closely related to the package’s implementation, or text files containing documentation that might be of interest to programmers using the package. These files are called “package data”.</p>

    <p>The value must be a mapping from package name to a list of relative path names that should be copied into the package. The paths are interpreted as relative to the directory containing the package.</p>
  </li>
  <li>
    <p>data_files: Although configuring package_data is sufficient for most needs, in some cases you may need to place data files outside of your packages. The data_files directive allows you to do that.</p>

    <p>Each (directory, files) pair in the sequence specifies the installation directory and the files to install there. If directory is a relative path, it is interpreted relative to the installation prefix (Python’s sys.prefix for pure-Python distributions, sys.exec_prefix for distributions that contain extension modules). Each file name in files is interpreted relative to the setup.py script at the top of the project source distribution.</p>
  </li>
  <li>scripts:</li>
  <li>entry_points</li>
  <li>console_scripts: Use “console_script” entry points to register your script interfaces. You can then let the toolchain handle the work of turning these interfaces into actual scripts [2]. The scripts will be generated during the install of your distribution.</li>
</ul>

<hr />

<h1 id="id-build-your-package">Build your package</h1>

<p>python package 的类型有两种：</p>

<p>pip can install from either Source Distributions (sdist) or Wheels, but if both are present on PyPI, pip will prefer a compatible wheel.</p>

<p>Wheels are a pre-built distribution format that provides faster installation compared to Source Distributions (sdist), especially when a project contains compiled extensions.</p>

<ul>
  <li><a href="(https://packaging.python.org/en/latest/glossary/#term-source-distribution-or-sdist)">Source Distributions(sdist)</a>:</li>
  <li>Wheel:</li>
</ul>

<p>采用如下命令即可编译成 <a href="https://packaging.python.org/en/latest/glossary/#term-source-distribution-or-sdist">source distribution</a>:</p>

<pre><code>python setup.py sdist
</code></pre>

<p>If your project is pure python (i.e. contains no compiled extensions) and natively supports both Python 2 and 3, then you’ll be creating what’s called a “Universal Wheel” (see section below).</p>

<p>If your project is pure python but does not natively support both Python 2 and 3, then you’ll be creating a “Pure Python Wheel” (see section below).</p>

<p>If you project contains compiled extensions, then you’ll be creating what’s called a “Platform Wheel” (see section below).</p>

<p>采用如下命令可编译成 wheel:</p>

<pre><code>python setup.py bdist_wheel 
</code></pre>

<p>采用如下命令可编译成 universal wheel</p>

<pre><code>python setup.py bdist_wheel --universal
</code></pre>

  </div>

</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">koala bear</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>koala bear</li>
          <li><a href="mailto:vanderliang@gmail.com">vanderliang@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/deliangfan"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">deliangfan</span></a>

          </li>
          

          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>观水有术，必观其澜，日月有明，容光必照。
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
