---
layout: post
title:  "标注平台二三事"
categories: 机器学习之工程
---


数据标注是如今深度学习获得巨大成功的基石

从Feifei Li创建ImageNet（1千多万张、2万多类别图片）开始




## 机器学习中的标注业务



涵盖了计算视觉，NLP，音频，CTR 领域，除了 CTR 领域，一般通过埋点来业务场景构建属于自己的样本，在计算视觉和 NLP 领域，有非常多的开源项目，相关人士整理了许多的训练数据集合，著名的有。这些数据为相对通用的深度学习领域奠定了基石。但是具体到某个细分领域，往往没有现成的数据集，需要用户自身整理和标注数据。以计算视觉的分类任务为例，Image XX 能够很好的区分人和猫，但是我们蘑菇街的某些业务要求对衣服进行分类，比如是连衣裙，毛衣针织衫等。

通常而言，具有标注需求的业务场景大致可以分为如下场景

- 计算视觉

 - 分类：对图片和视频进行分类
 - 分割：对图片或视频进行分割
 - 目标检测：一般采用矩形框圈出目标，并给与标注信息

- NLP

 - 分类：对文本进行分类，比如情感分类
 - 实体识别：失败
 - 翻译：
 - 关系提取

- 音频

 - 分类
 - 识别

以蘑菇街为例，在计算视觉有许多服饰相关的细分场景需要标注数据，NLP 也有较多的标注场景和需求，强大的用户管理方便
 
 具体到蘑菇街，我们深度学习主要在 CTR、计算视觉和 NLP 中广泛应用

## 开源的标注平台

Github 上诞生了许多开源的标注项目，涵盖了计算视觉，NLP，音频等业务领域，特别在计算视觉方面，诸多优秀而人气旺盛的开源项目如雨后春笋一般，其中不乏有著名社区如 OpenCV 和商业公司 MS 等的支持。

这些优秀的开源项目以具体业务为导向，它们能够很好的完成具体某个任务的标注，有些还甚至支持生成训练样本。对规模较小，机器学习业务较为单一的团队很适合，开箱即用。


笔者梳理了部分计算视觉、NLP、和音频领域部分人气较好的标注项目，如下表所示。这些项目业务场景为导向，在某个具体的领域，如计算视觉中的目标检测，NLP 中的命名实体分割提供了比较通用的方案，用户仅仅需要简单的安装和配置即可开始标注数据，并将标注结果以某种形式输出。它们虽然能够解决某个领域中的标注问题，但是它们在形态上存在较大差异，比如有的是以 Web 形式提供服务，有的是桌面软件(GUI)；有些直接将数据生成 xml，有的将结果保存在 MySQL 或者 No SQL 中。

| 项目 | 适合场景 | 说明 | 桌面/Web | stars |
| --- | --- |--- | --- | --- |
| [labelImg](https://github.com/tzutalin/labelImg) | 目标检测(图像) | 采用矩形框标注目标，结果保存至本地 xml 文件| 桌面软件 | 8.8K |
| [cvat](https://github.com/opencv/cvat) | 目标检测、分割、分类任务(图像和视频) | 功能强大，支持图像和视频的多种标准场景，支持导出多种格式结果文件 | Django Web 服务 | 2.6K|
| [labelme](https://github.com/wkentaro/labelme)| 目标检测、分割、分类任务(图像) | 功能较为强大 | 桌面软件 | 3.5K |
| [vatic](https://github.com/cvondrick/vatic)| 目标检测、目标跟踪(视频) | 面向视频的目标检测和目标跟踪，结果保存至 DB 中 | Web 服务 | 0.4K |
| [doccano](https://github.com/chakki-works/doccano)| NLP 命名实体识别、文本分类、翻译任务 | 功能强大，支持多种语言，支持用户管理，结果保存至 SQL DB 中 | Django Web 服务 | 1.9K |
| [Chinese-Annotator](https://github.com/deepwel/Chinese-Annotator) | NLP 命名实体识别、文本分类、关系提取  | 面向中文的智能文本标注，结果保存至 Mongo DB 中 | Django Web 服务 | 0.9 K |
| [audio-annotator](https://github.com/CrowdCurio/audio-annotator)  | 音频分类标注 | 面向音频片段的分类标注 | Web 服务 | 0.2K |

对于业务场景较为单一的，团队规模较小的公司而言，针对具体的任务直接采用适合的开源的标注工具，是最为简便省事的方法。但是对于算法业务场景复杂，团队规模较大，标注场景比较特殊的公司而言，直接基于上述标注工具虽然在一定程度上能够满足要求，但是会带来巨大的维护成本，具体从如下三个方面来阐述。

1) 用户管理：像旷世科技等 AI 独角兽，IPO 募股书显示它的标注员工多大 405 人，占公司员工比例的 17.2 %，多标注用户下肯定有用户管理，权限管理和工作量统计的相关需求。即使对于算法规模较小的企业，如蘑菇街而言，也有大量的标注需求，这些标注任务绝大部分外包给相关的标注公司，由标注公司完成标注，所以用户管理模块的重要性不言而喻。

2) 数据管理：上述标注任务，有些直接将数据保存到 xml 中，有些保存到 MySQL，有些则保存到 NoSQL，此外，不同项目的数据格式也存在较大的差异，不利于管理和维护。特别对于本地 xml 文件，后期的存储和维护存在隐患和较高的成本。因此，标注的数据应该采用统一的高可靠存储，不仅简化维护和管理工作，而且能和样本构建模块良好的衔接。

3) 服务管理：在多人标注，特别在外包员工标注的场景下，如果采用上述桌面软件，会涉及大量服务部署和维护的问题，同时也存在大量数据分发的问题。例如，上百万张图片通常占大数百个 GB，这些数据的分发和分配也会带来浩大的工作量，尤其在涉及太多人肉处理的环境，很可能引入意想不到的错误。所以标注工具应该以 web 服务形式提供，最好以统一的 Web 入口提供，标注人员无论身处何处，采用何种操作系统，仅需登录 web 界面即可开展工作；对研发人员而言，维护一个统一的前后端服务的工作量远远低于维护多个标注工具。

由上可知，面对标注业务较为繁多的企业而言，构建统一的标注平台非常有必要。它规范化了流程和风格，对外提供简单易用的标注功能，支持多人及外包标注，降低维护成本；同时把数据存储集中化，数据结构标准化，为下游的样本生成模块奠定良好的基础。

## 蘑菇街标注平台的设计

本节重点谈谈蘑菇街标注平台的设计，

- 图片分类，视频分类，NLP 实体，图片相似度。
- 支持外包，用户管理和权限管理。
- 简单易用，和已有系统集成。

### 设计要点

- 面向流程进行抽象 vs 面向业务场景
- 数据集中存放，图片视频存 CDN，标注数据存 DB。
- 服务以 Web 形式提供
- 高可扩展性：不同的标注项目，将思路和前端的代码移植，

对于管理者来说，其流程如下：

```
管理者：登陆 ---> 选择项目 ---> 导入数据文件(待标注完成后) ---> 审核标注结果 
标注者：登陆 ---> 选择项目 ---> 领取标注数据 ---> 开始标注
```

### 具体实现 

标注平台




Python Django



```


             +----------+
             | LB       |
             +----------+

				+----------+
				|  Server  |
				+----------+
					
		+----+               +--------+
		| DB |               | S3/CDN |
		+----+               +--------+
```


NLP 类


1. 标注平台要接入多个项目
2. 抽象，建议以流程进行抽象，不同的项目在业务，web 等等差异非常大。
3. 标注数据的存储，图片视频存 CDN，其它存 DB，而且 DB 字段在设计过程中因围绕流程进行抽象，避免为某个业务开设字段，标注信息全部存在 text 格式，由业务方进行解析。


1. 用户权限管理
2. 

https://www.infoq.cn/article/OOFtcgKNej1TJvW6u7FR


1. 图片 + 分类器训练标签（ ResNets ）
2. 包围框 + 检测器标签（ YOLOv3，Faster R-CNN ……）
3. 多边形 + 用于分割应用程序标签（ Mask R-CNN ）

——————————

NLP

中文文本标注

https://github.com/deepwel/Chinese-Annotator

关于标注 https://github.com/chakki-works/doccano.git


https://juejin.im/pin/5b7a8b63e51d45038212ae97